<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–í—Ö–æ–¥ –≤ Valorant</title>
    <!-- –ü–æ–¥–∫–ª—é—á–∞–µ–º —Å–∫—Ä–∏–ø—Ç Telegram, —á—Ç–æ–±—ã Mini App —Ä–∞–±–æ—Ç–∞–ª -->
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif;
            background-color: var(--tg-theme-bg-color, #fff);
            color: var(--tg-theme-text-color, #000);
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 20px;
            text-align: center;
        }
        .container {
            max-width: 400px;
            width: 100%;
        }
        .btn {
            background-color: var(--tg-theme-button-color, #3390ec);
            color: var(--tg-theme-button-text-color, #fff);
            border: none;
            padding: 12px 24px;
            border-radius: 12px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            text-decoration: none;
            display: block;
            margin: 10px 0;
            width: 100%;
            box-sizing: border-box;
            transition: opacity 0.2s;
        }
        .btn:active { opacity: 0.8; }
        textarea {
            width: 100%;
            height: 80px;
            border-radius: 12px;
            border: 2px solid var(--tg-theme-hint-color, #ccc);
            padding: 10px;
            box-sizing: border-box;
            background-color: var(--tg-theme-secondary-bg-color, #f0f0f0);
            color: var(--tg-theme-text-color, #000);
            resize: none;
            font-size: 14px;
            margin-bottom: 10px;
        }
        textarea:focus {
            border-color: var(--tg-theme-button-color, #3390ec);
            outline: none;
        }
        .step {
            background: var(--tg-theme-secondary-bg-color, #f5f5f5);
            padding: 15px;
            border-radius: 15px;
            margin-bottom: 20px;
            text-align: left;
        }
        h3 { margin-top: 0; font-size: 18px; margin-bottom: 10px;}
        p { font-size: 14px; line-height: 1.4; margin-bottom: 10px; color: var(--tg-theme-hint-color, #555); }
    </style>
</head>
<body>

    <div class="container">
        <h2>–ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è</h2>
        
        <div class="step">
            <h3>–®–∞–≥ 1. –í—Ö–æ–¥</h3>
            <p>–ù–∞–∂–º–∏ –∫–Ω–æ–ø–∫—É, –≤–æ–π–¥–∏ –≤ –∞–∫–∫–∞—É–Ω—Ç Riot. –ö–æ–≥–¥–∞ —É–≤–∏–¥–∏—à—å –±–µ–ª—ã–π —ç–∫—Ä–∞–Ω –∏–ª–∏ –ª–æ–≥–æ—Ç–∏–ø ‚Äî —Å–∫–æ–ø–∏—Ä—É–π —Å—Å—ã–ª–∫—É –∏–∑ –±—Ä–∞—É–∑–µ—Ä–∞.</p>
            <!-- –°—Å—ã–ª–∫–∞ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏ —Å –ø–∞—Ä–∞–º–µ—Ç—Ä–∞–º–∏ -->
            <a href="https://auth.riotgames.com/authorize?redirect_uri=https%3A%2F%2Fplayvalorant.com%2Fopt_in&client_id=play-valorant-web-prod&response_type=token%20id_token&nonce=1&scope=account%20openid" target="_blank" class="btn">üöÄ –û—Ç–∫—Ä—ã—Ç—å Riot Login</a>
        </div>

        <div class="step">
            <h3>–®–∞–≥ 2. –¢–æ–∫–µ–Ω</h3>
            <p>–í—Å—Ç–∞–≤—å —Å–∫–æ–ø–∏—Ä–æ–≤–∞–Ω–Ω—É—é —Å—Å—ã–ª–∫—É —Å—é–¥–∞:</p>
            <textarea id="urlInput" placeholder="https://playvalorant.com/opt_in#access_token=..."></textarea>
            
            <button id="sendBtn" class="btn" style="background-color: #2ea043; display: none;">‚úÖ –ì–æ—Ç–æ–≤–æ! –ü–æ–¥–∫–ª—é—á–∏—Ç—å</button>
        </div>
    </div>

    <script>
        const tg = window.Telegram.WebApp;
        tg.expand(); // –†–∞—Å—Ç—è–≥–∏–≤–∞–µ–º –Ω–∞ –≤–µ—Å—å —ç–∫—Ä–∞–Ω

        const urlInput = document.getElementById('urlInput');
        const sendBtn = document.getElementById('sendBtn');

        // –°–ª—É—à–∞–µ–º –≤–≤–æ–¥ —Ç–µ–∫—Å—Ç–∞
        urlInput.addEventListener('input', () => {
            const text = urlInput.value;
            // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –∫–Ω–æ–ø–∫—É —Ç–æ–ª—å–∫–æ –µ—Å–ª–∏ —Å—Å—ã–ª–∫–∞ –ø–æ—Ö–æ–∂–∞ –Ω–∞ –ø—Ä–∞–≤–∏–ª—å–Ω—É—é
            if (text.includes('access_token=') || text.includes('id_token=')) {
                sendBtn.style.display = 'block';
            } else {
                sendBtn.style.display = 'none';
            }
        });

        // –û–±—Ä–∞–±–æ—Ç–∫–∞ –Ω–∞–∂–∞—Ç–∏—è "–ì–æ—Ç–æ–≤–æ"
        sendBtn.addEventListener('click', () => {
            const text = urlInput.value;
            
            try {
                // –ü—ã—Ç–∞–µ–º—Å—è —Ä–∞—Å–ø–∞—Ä—Å–∏—Ç—å —Å—Å—ã–ª–∫—É
                // –ó–∞–º–µ–Ω—è–µ–º # –Ω–∞ ? —á—Ç–æ–±—ã URL –∫–ª–∞—Å—Å –º–æ–≥ –ø—Ä–æ—á–∏—Ç–∞—Ç—å –ø–∞—Ä–∞–º–µ—Ç—Ä—ã
                let cleanUrl = text.replace('#', '?'); 
                const urlObj = new URL(cleanUrl);
                const params = new URLSearchParams(urlObj.search);
                
                const accessToken = params.get('access_token');
                
                if (accessToken) {
                    // –û—Ç–ø—Ä–∞–≤–ª—è–µ–º –¥–∞–Ω–Ω—ã–µ –±–æ—Ç—É (–≤ Python)
                    const data = JSON.stringify({
                        access_token: accessToken
                    });
                    tg.sendData(data);
                } else {
                    tg.showAlert('–í —Å—Å—ã–ª–∫–µ –Ω–µ—Ç —Ç–æ–∫–µ–Ω–∞! –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ —Å–∫–æ–ø–∏—Ä–æ–≤–∞–ª–∏ –≤—Å—ë.');
                }
            } catch (e) {
                // –ï—Å–ª–∏ –ø–∞—Ä—Å–∏–Ω–≥ –Ω–µ —É–¥–∞–ª—Å—è, –ø—Ä–æ–±—É–µ–º –≥—Ä—É–±—ã–π –º–µ—Ç–æ–¥
                if (text.includes("access_token=")) {
                    const start = text.indexOf("access_token=") + 13;
                    const end = text.indexOf("&", start);
                    const token = text.substring(start, end === -1 ? undefined : end);
                    tg.sendData(JSON.stringify({ access_token: token }));
                } else {
                    tg.showAlert("–ù–µ–≤–µ—Ä–Ω–∞—è —Å—Å—ã–ª–∫–∞. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –µ—â–µ —Ä–∞–∑.");
                }
            }
        });
    </script>
</body>
</html>
